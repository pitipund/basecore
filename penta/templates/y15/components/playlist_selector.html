<style type="text/css">

  .ps-item {
    width: 100%;
    height: 100px;
    padding: 3px;
    opacity: 0.7;
  }

  .ps-name{
      float: left;
      width: 70%;
      font-size: 17;
      font-weight: 500;
      padding-left: 10px;
      height: 100%;
  }

  .ps-item.selected {
    padding: 0px;
    border: #16c1f3 3px solid;
    background-color: #cff;
    opacity: 1.0;
  }

  .ps-image {
    max-width: 30%;
    height: 100%;
    float: left;
  }

  .modal-body{
    height: 250px; 
    overflow-y: scroll;
  }


</style>

<div class="modal fade" id="playlistSelector">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title">เลือกวิดีโอที่คุณต้องการแนบใน mail</h4>
      </div>
      <div class="modal-body">
        <div id="playlistSelectorContent" ></div>
        <button id="loadMoreVideo" data-loading-text="Loading..." class="btn btn-default">More</button>
      </div>
      <div class="modal-footer clearfix">
        <button type="button" class="btn btn-default" data-dismiss="modal">ยกเลิก</button>
        <button id="playlistSelectorButton" type="button" class="btn btn-success"><span class="glyphicon glyphicon-refresh glyphicon-refresh-animate hidden"></span> เลือก</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<script>

  {% if mail.playlist %}
  var selected_pid ={{mail.playlist.id}};
  {% else %}
  var selected_pid =-1;
  {% endif %}

  var selective_class,
      playlist_selector_count = 1,
      loadMoreVideo = $("#loadMoreVideo");

  loadMoreVideo.click(function(){
    var loadBtn = $(this), index;
    loadBtn.button("loading");
    $.get("/api/v2/channel/{{c.id}}/playlist/?page="+playlist_selector_count+"&per_page=10",function(result){
      console.log(result.has_other_pages);
      var playlists = result.playlists;
      for(index in playlists) {
        var playlist = playlists[index],
            link = playlist.link;
        if(playlist.id==selected_pid)
          selective_class = "selected";
        else 
          selective_class = "";
        var newDom = "<div class='ps-item "+selective_class+"' data-name='"+link.name+"' data-pid='"+playlist.id+"'>"+
                "<img class='ps-image' src='"+link.real_thumbnail+"'><img>"+
                "<div class='ps-name'>"+link.name+"</div>"+
                "</div>";
        $("#playlistSelectorContent").append(newDom)
      }
      if(result.has_other_pages) {
        playlist_selector_count+=1; 
      } else {
        loadBtn.text("No video to load anymore.");
        loadBtn.attr("disabled","disabled");
        return;
      }
      loadBtn.button("reset");
    });
  });

  loadMoreVideo.click();

  $("#playlistSelectorContent").on("click",".ps-item",function(){
    $(".ps-item").removeClass("selected");
    $(this).addClass("selected");
  });

  $("#playlistSelectorButton").click(function(){
      var selected_item = $(".ps-item.selected"),
          pid = selected_item.data("pid"),
          name = selected_item.data("name"),
          video_position_input = $("input[name=video_position]"),
          mailPreviewVideo = $(".mail-preview-video");
      $("input#selectedVideo").val(name);
      $("input[name='playlist']").val(pid);
      if(video_position_input.val()=="")
          video_position_input.val(1);

      mailPreviewVideo.attr('src', $("#playlistSelectorContent").find(".ps-item.selected > img.ps-image").attr('src')).show();
      mailPreviewVideo.parent().attr("href","/th/channelplay/{{c.id}}/"+selected_pid+"/");

      $("#playlistSelector").modal("hide");
  });
</script>